!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.r=function(exports){Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="./",__webpack_require__(__webpack_require__.s=4)}([function(module,exports){var ColorPalette;!function(ColorPalette){ColorPalette.Monochrome="none",ColorPalette.Grey2Bit="grey2bit",ColorPalette.Grey4Bit="grey4bit",ColorPalette.Grey8Bit="grey8bit",ColorPalette.Color3Bit="color3bit",ColorPalette.Color4Bit="color4bit",ColorPalette.ColorFull="color"}(ColorPalette||(ColorPalette={}));var generator=new(function(){function AsciiArtGenerator(){var _this=this;this.settings={charSet:" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",url:"/avatar.png",charSamples:1,size:50,contrast:0,brightness:0,alpha:0,ColorPalette:ColorPalette.Monochrome,debug:!1,isDemoRunning:!0,saveAsHtml:function(){_this.asciiElement.style.setProperty("--width",_this.width.toString()),_this.asciiElement.style.setProperty("--height",_this.height.toString());var blob=new Blob([_this.asciiElement.outerHTML]);_this.exportElement.href=URL.createObjectURL(blob),_this.exportElement.click()}},this.demoDirection=-1,this.demoSettings=[{url:"/avatar.png",size:50,charSamples:1},{url:"/slogan.png",size:60,charSamples:2},{url:"/codepen.png",size:120,charSamples:2}],this.demoIndex=0,this.isImageLoaded=!1,this.charRegions={},this.colorMap=[],this.valueMap=[],this.normalizedMap=[],this.width=0,this.height=0,this.cachedUrls={},this.colorPalettes={};var elements=this.elements;this.asciiElement=elements.asciiElement,this.exportElement=elements.exportElement,this.debugImageElement=elements.debugImageElement,this.debugCharsElement=elements.debugCharsElement,this.initGui(),this.generatePalettes(),this.analyzeCharRegions(),this.loadFromUrl(),this.initDemo()}return AsciiArtGenerator.prototype.initDemo=function(){var _this=this;this.demo();var stopDemo=function(){_this.settings.isDemoRunning=!1,window.removeEventListener("mousedown",stopDemo)};window.addEventListener("mousedown",stopDemo)},AsciiArtGenerator.prototype.initGui=function(){var _this=this,gui=new dat.GUI;gui.add(this.settings,"charSet").onChange(function(){_this.analyzeCharRegions(),_this.generate()}),gui.add(this.settings,"url").listen().onChange(function(){return _this.loadFromUrl()}),gui.add(this.settings,"charSamples",1,3,1).listen().onChange(function(){_this.analyzeCharRegions(),_this.loadFromUrl()}),gui.add(this.settings,"size",10,150,1).listen().onChange(function(){return _this.loadFromUrl()}),gui.add(this.settings,"contrast",-1,1,.01).onChange(function(){_this.normalizeValueMap(),_this.generate()}),gui.add(this.settings,"brightness",-1,1,.01).listen().onChange(function(){_this.normalizeValueMap(),_this.generate()}),gui.add(this.settings,"alpha",-1,1,.01).onChange(function(){return _this.generate()}),gui.add(this.settings,"ColorPalette",ColorPalette).onChange(function(){_this.generate()}),gui.add(this.settings,"debug").onChange(function(){_this.analyzeCharRegions(),_this.loadFromUrl()}),gui.add(this.settings,"isDemoRunning").listen().onChange(function(){_this.settings.isDemoRunning&&_this.demo()}),gui.add(this.settings,"saveAsHtml")},Object.defineProperty(AsciiArtGenerator.prototype,"elements",{get:function(){var asciiElement=document.getElementById("ascii");if(!asciiElement)throw"#ascii Element is missing";var exportElement=document.getElementById("export");if(!exportElement)throw"#export Element is missing";var debugImageElement=document.getElementById("debug-image");if(!debugImageElement)throw"#debug-image Element is missing";var debugCharsElement=document.getElementById("debug-chars");if(!debugCharsElement)throw"#debug-chars Element is missing";return{asciiElement,exportElement,debugImageElement,debugCharsElement}},enumerable:!0,configurable:!0}),AsciiArtGenerator.prototype.generatePalettes=function(){this.colorPalettes[ColorPalette.Grey2Bit]=[[0,0,0],[104,104,104],[184,184,184],[255,255,255]],this.colorPalettes[ColorPalette.Grey4Bit]=[];for(var i=0;i<16;i+=1)this.colorPalettes[ColorPalette.Grey4Bit].push([17*i,17*i,17*i]);this.colorPalettes[ColorPalette.Grey8Bit]=[];for(i=0;i<256;i+=1)this.colorPalettes[ColorPalette.Grey8Bit].push([i,i,i]);this.colorPalettes[ColorPalette.Color3Bit]=[[0,0,0],[0,249,45],[0,252,254],[255,48,21],[255,62,253],[254,253,52],[16,37,251],[255,255,255]],this.colorPalettes[ColorPalette.Color4Bit]=this.colorPalettes[ColorPalette.Color3Bit].slice();for(i=1;i<8;i+=1)this.colorPalettes[ColorPalette.Color4Bit].push([32*i,32*i,32*i])},AsciiArtGenerator.prototype.analyzeChar=function(char){var canvas=document.createElement("canvas");canvas.width=12,canvas.height=12;var ctx=canvas.getContext("2d");if(!ctx)throw"context creation failed";ctx.font="12px monospace",ctx.fillText(char,2,10);for(var data=ctx.getImageData(0,0,12,12).data,values=[],size=12/this.settings.charSamples,cellY=0;cellY<this.settings.charSamples;cellY+=1)for(var cellX=0;cellX<this.settings.charSamples;cellX+=1){for(var value=0,posY=0;posY<size;posY+=1)for(var posX=0;posX<size;posX+=1)value+=data[4*(cellX*size+posX+12*(cellY*size+posY))+3];values.push(value/(size*size)/255)}if(this.settings.debug){this.debugCharsElement.appendChild(canvas);for(cellX=0;cellX<this.settings.charSamples;cellX+=1)for(cellY=0;cellY<this.settings.charSamples;cellY+=1)ctx.fillStyle="rgba(255, 0, 255, "+values[cellX+cellY*this.settings.charSamples]+")",ctx.fillRect(cellX*size,cellY*size,size,size);console.log({char,values})}this.charRegions[char]=values},AsciiArtGenerator.prototype.normalizeCharRegions=function(){var min=1,max=0;for(var char in this.charRegions)for(var _i=0,_a=this.charRegions[char];_i<_a.length;_i++){var region=_a[_i];min>region&&(min=region),max<region&&(max=region)}if(max>0&&min!=max){var diff=max-min;for(var char in this.charRegions)for(var regions=this.charRegions[char],index=0;index<regions.length;index+=1)regions[index]=(regions[index]-min)*(1/diff)}this.settings.debug&&console.log({min,max,charRegions:this.charRegions})},AsciiArtGenerator.prototype.analyzeCharRegions=function(){this.clearElement(this.debugCharsElement),this.charRegions={};for(var _i=0,_a=this.settings.charSet;_i<_a.length;_i++){var char=_a[_i];this.analyzeChar(char)}this.normalizeCharRegions()},AsciiArtGenerator.prototype.loadFromUrl=function(){var _this=this;if(this.isImageLoaded=!1,this.cachedUrls[this.settings.url])this.onImageLoaded(this.cachedUrls[this.settings.url]);else{var img_1=document.createElement("img");img_1.crossOrigin="Anonymous",img_1.src=this.settings.url,img_1.addEventListener("load",function(){_this.cachedUrls[_this.settings.url]=img_1,_this.onImageLoaded(img_1)}),img_1.addEventListener("error",function(){var urls=Object.keys(_this.cachedUrls);urls.length>0&&_this.onImageLoaded(_this.cachedUrls[urls[urls.length-1]])})}},AsciiArtGenerator.prototype.onImageLoaded=function(img){this.width=this.settings.size,this.height=~~(img.height/img.width*this.width/1.9);var canvas=document.createElement("canvas");canvas.width=this.width*this.settings.charSamples,canvas.height=this.height*this.settings.charSamples;var ctx=canvas.getContext("2d");if(!ctx)throw"context creation failed";ctx.drawImage(img,0,0,this.width*this.settings.charSamples,this.height*this.settings.charSamples),this.clearElement(this.debugImageElement),this.settings.debug&&(this.debugImageElement.appendChild(canvas),console.log({img,width:this.width,height:this.height})),document.body.style.setProperty("--width",this.width.toString()),document.body.style.setProperty("--height",this.height.toString()),this.generateValueMap(ctx),this.isImageLoaded=!0},AsciiArtGenerator.prototype.generateValueMap=function(ctx){this.valueMap=[],this.colorMap=[];for(var data=Array.from(ctx.getImageData(0,0,this.width*this.settings.charSamples,this.height*this.settings.charSamples).data),rowLength=this.width*this.settings.charSamples*4,cellY=0;cellY<this.height;cellY+=1)for(var cellX=0;cellX<this.width;cellX+=1){var cell=[],pos=cellX*this.settings.charSamples*4+cellY*this.settings.charSamples*rowLength;this.colorMap.push(data.slice(pos,pos+4));for(var posY=0;posY<this.settings.charSamples;posY+=1)for(var posX=0;posX<this.settings.charSamples;posX+=1){var pos_1=4*(cellX*this.settings.charSamples+posX)+(cellY*this.settings.charSamples+posY)*rowLength,alpha=data[pos_1+3]/255,values=data.slice(pos_1,pos_1+3),value=1-((values[0]+values[1]+values[2])/765*alpha+1-alpha);this.settings.debug&&(ctx.fillStyle="rgba(255, 0, 255, "+value+")",ctx.fillRect(cellX*this.settings.charSamples+posX,cellY*this.settings.charSamples+posY,1,1)),cell.push(value)}this.valueMap.push(cell)}this.settings.debug&&console.log({valueMap:this.valueMap,colorMap:this.colorMap}),this.normalizeValueMap(),this.generate()},AsciiArtGenerator.prototype.normalizeValueMap=function(){for(var min=1,max=0,_i=0,_a=this.valueMap;_i<_a.length;_i++)for(var _b=0,regions_1=regions=_a[_i];_b<regions_1.length;_b++){var region=regions_1[_b];min>region&&(min=region),max<region&&(max=region)}if(max>0&&min!=max){var diff=max-min;this.normalizedMap=[];for(var _c=0,_d=this.valueMap;_c<_d.length;_c++){for(var regions=_d[_c],normals=Array.from(regions),index=0;index<normals.length;index+=1)normals[index]=(normals[index]-min)*(1/diff),normals[index]=(this.settings.contrast+1)*(normals[index]-.5)+.5+this.settings.brightness;this.normalizedMap.push(normals)}}else this.normalizedMap=this.valueMap;this.settings.debug&&console.log({min,max,valueMap:this.valueMap})},AsciiArtGenerator.prototype.getClosestChar=function(values){var minDiff=Number.MAX_VALUE,minChar="";for(var char in this.charRegions){for(var regions=this.charRegions[char],diff=0,index=0;index<regions.length;index++)diff+=Math.abs(regions[index]-values[index]);diff<minDiff&&(minDiff=diff,minChar=char)}return minChar},AsciiArtGenerator.prototype.clearElement=function(element){for(;element.firstChild;)element.removeChild(element.firstChild)},AsciiArtGenerator.prototype.arrayToRgba=function(color){return"rgba("+(color[0]>0?~~color[0]:255)+","+(color[1]>0?~~color[1]:255)+","+(color[2]>0?~~color[2]:255)+","+Math.max(0,Math.min(1,color[3]/255+this.settings.alpha))+")"},AsciiArtGenerator.prototype.getCharColor=function(color){if(this.settings.ColorPalette===ColorPalette.ColorFull)return this.arrayToRgba(color);for(var closestColor=[0,0,0],minDiff=Number.MAX_VALUE,_i=0,_a=this.colorPalettes[this.settings.ColorPalette];_i<_a.length;_i++){var paletteColor=_a[_i],diff=Math.abs(color[0]-paletteColor[0])+Math.abs(color[1]-paletteColor[1])+Math.abs(color[2]-paletteColor[2]);diff<minDiff&&(minDiff=diff,closestColor=paletteColor)}return this.arrayToRgba(closestColor.concat([color[3]]))},AsciiArtGenerator.prototype.generate=function(){this.clearElement(this.asciiElement);for(var cellY=0;cellY<this.height;cellY+=1)for(var cellX=0;cellX<this.width;cellX+=1){var cell=document.createElement("div");this.settings.ColorPalette!==ColorPalette.Monochrome&&(cell.style.color=this.getCharColor(this.colorMap[cellX+cellY*this.width])),cell.innerHTML=this.getClosestChar(this.normalizedMap[cellX+cellY*this.width]).replace(" ","&nbsp;"),this.asciiElement.appendChild(cell)}},AsciiArtGenerator.prototype.demo=function(){var _this=this;this.settings.isDemoRunning&&(this.isImageLoaded&&(this.settings.brightness+=.05*this.demoDirection,this.normalizeValueMap(),this.generate(),(this.settings.brightness>=0||this.settings.brightness<=-1)&&(this.demoDirection*=-1),this.settings.brightness<=-1&&(this.demoIndex=(this.demoIndex+1)%this.demoSettings.length,this.settings.url=this.demoSettings[this.demoIndex].url,this.settings.size=this.demoSettings[this.demoIndex].size,this.settings.charSamples=this.demoSettings[this.demoIndex].charSamples,this.analyzeCharRegions(),this.loadFromUrl())),requestAnimationFrame(function(){return _this.demo()}))},AsciiArtGenerator}());console.log(generator)},function(module,exports){module.exports='<div id="ascii" style="\n    display: grid;\n    grid-template-columns: repeat(var(--width), 1fr);\n    font-family: \'Courier New\', Courier, monospace;\n    font-size: 9px;\n    width: calc(var(--width) * 5.41px);\n    height: calc(var(--height) * 10px);\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n  ">\n</div>\n<div id="debug-image"></div>\n<div id="debug-chars"></div>\n<a id="export" href="#" download="ascii-art.html"></a>\n'},function(module,exports){},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(2);const body=__webpack_require__(1);document.body.innerHTML=body},function(module,exports,__webpack_require__){__webpack_require__(3),module.exports=__webpack_require__(0)}]);
//# sourceMappingURL=bundle.8dae36d575892f3fc57d.js.map